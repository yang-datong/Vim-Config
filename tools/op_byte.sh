#!/bin/bash

set -e

if [ ! -x "$(command -v $obj g++)" ]; then
	echo "g++ is not installed. Please install g++ to proceed."
	exit 1
fi

echo "I2luY2x1ZGUgPGNtYXRoPgojaW5jbHVkZSA8Y3N0ZGludD4KI2luY2x1ZGUgPGZzdHJlYW0+CiNpbmNsdWRlIDxpb3N0cmVhbT4KI2luY2x1ZGUgPHN0cmluZz4KI2luY2x1ZGUgPHZlY3Rvcj4KCmJvb2wgaW5zZXJ0Qnl0ZXMoY29uc3Qgc3RkOjpzdHJpbmcgJmZpbGVuYW1lLCBsb25nIG9mZnNldCwgaW50IG51bUJ5dGVzLAogICAgICAgICAgICAgICAgIGNvbnN0IHN0ZDo6dmVjdG9yPHVpbnQ4X3Q+ICZpbnNlcnREYXRhID0ge30pIHsKICBzdGQ6OmZzdHJlYW0gZmlsZShmaWxlbmFtZSwgc3RkOjppb3M6OmluIHwgc3RkOjppb3M6Om91dCB8IHN0ZDo6aW9zOjpiaW5hcnkpOwoKICBpZiAoIWZpbGUuaXNfb3BlbigpKSB7CiAgICBzdGQ6OmNlcnIgPDwgIkVycm9yIG9wZW5pbmcgZmlsZTogIiA8PCBmaWxlbmFtZSA8PCBzdGQ6OmVuZGw7CiAgICByZXR1cm4gZmFsc2U7CiAgfQoKICAvLyDojrflj5bmlofku7blpKflsI8KICBmaWxlLnNlZWtnKDAsIHN0ZDo6aW9zOjplbmQpOwogIGxvbmcgZmlsZVNpemUgPSBmaWxlLnRlbGxnKCk7CiAgZmlsZS5zZWVrZygwLCBzdGQ6Omlvczo6YmVnKTsKCiAgLy8g5qOA5p+l5YGP56e76YeP5piv5ZCm5pyJ5pWICiAgaWYgKG9mZnNldCA8IDAgfHwgb2Zmc2V0ID4gZmlsZVNpemUpIHsKICAgIHN0ZDo6Y2VyciA8PCAiSW52YWxpZCBvZmZzZXQ6ICIgPDwgb2Zmc2V0IDw8IHN0ZDo6ZW5kbDsKICAgIHJldHVybiBmYWxzZTsKICB9CgogIC8vIOivu+WPluWBj+enu+mHj+S5i+WQjueahOaJgOacieaVsOaNrgogIHN0ZDo6dmVjdG9yPGNoYXI+IGJ1ZmZlcihmaWxlU2l6ZSAtIG9mZnNldCk7CiAgZmlsZS5zZWVrZyhvZmZzZXQpOwogIGZpbGUucmVhZChidWZmZXIuZGF0YSgpLCBidWZmZXIuc2l6ZSgpKTsKCiAgLy8g5YeG5aSH6KaB5o+S5YWl55qE5pWw5o2uCiAgc3RkOjp2ZWN0b3I8dWludDhfdD4gZGF0YVRvSW5zZXJ0OwogIGlmIChpbnNlcnREYXRhLmVtcHR5KCkpIHsKICAgIGRhdGFUb0luc2VydC5yZXNpemUobnVtQnl0ZXMsIDB4MDApOyAvLyDpu5jorqTloavlhYUgMHgwMAogIH0gZWxzZSB7CiAgICBkYXRhVG9JbnNlcnQgPSBpbnNlcnREYXRhOwogICAgaWYgKGRhdGFUb0luc2VydC5zaXplKCkgIT0gKGxvbmcgdW5zaWduZWQgaW50KW51bUJ5dGVzKSB7CiAgICAgIHN0ZDo6Y2VyciA8PCAiaW5zZXJ0RGF0YSBzaXplIG5vdCBlcXVhbCBudW1CeXRlcyIgPDwgc3RkOjplbmRsOwogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgfQoKICAvLyDnp7vliqjmlofku7bmjIfpkojliLDmj5LlhaXkvY3nva4KICBmaWxlLnNlZWtwKG9mZnNldCk7CgogIC8vIOWGmeWFpeimgeaPkuWFpeeahOaVsOaNrgogIGZpbGUud3JpdGUocmVpbnRlcnByZXRfY2FzdDxjb25zdCBjaGFyICo+KGRhdGFUb0luc2VydC5kYXRhKCkpLAogICAgICAgICAgICAgZGF0YVRvSW5zZXJ0LnNpemUoKSk7CgogIC8vIOWGmeWbnuS5i+WJjeivu+WPlueahOaVsOaNrgogIGZpbGUud3JpdGUoYnVmZmVyLmRhdGEoKSwgYnVmZmVyLnNpemUoKSk7CgogIGZpbGUuY2xvc2UoKTsKICByZXR1cm4gdHJ1ZTsKfQoKYm9vbCBkZWxldGVCeXRlcyhjb25zdCBzdGQ6OnN0cmluZyAmZmlsZW5hbWUsIGxvbmcgb2Zmc2V0LCBpbnQgbnVtQnl0ZXMpIHsKICBzdGQ6OmZzdHJlYW0gZmlsZShmaWxlbmFtZSwgc3RkOjppb3M6OmluIHwgc3RkOjppb3M6Om91dCB8IHN0ZDo6aW9zOjpiaW5hcnkpOwoKICBpZiAoIWZpbGUuaXNfb3BlbigpKSB7CiAgICBzdGQ6OmNlcnIgPDwgIkVycm9yIG9wZW5pbmcgZmlsZTogIiA8PCBmaWxlbmFtZSA8PCBzdGQ6OmVuZGw7CiAgICByZXR1cm4gZmFsc2U7CiAgfQoKICAvLyDojrflj5bmlofku7blpKflsI8KICBmaWxlLnNlZWtnKDAsIHN0ZDo6aW9zOjplbmQpOwogIGxvbmcgZmlsZVNpemUgPSBmaWxlLnRlbGxnKCk7CiAgZmlsZS5zZWVrZygwLCBzdGQ6Omlvczo6YmVnKTsKCiAgLy8g5qOA5p+l5YGP56e76YeP5ZKM5Yig6Zmk5a2X6IqC5pWw5piv5ZCm5pyJ5pWICiAgaWYgKG9mZnNldCA8IDAgfHwgb2Zmc2V0ICsgbnVtQnl0ZXMgPiBmaWxlU2l6ZSkgewogICAgc3RkOjpjZXJyIDw8ICJJbnZhbGlkIG9mZnNldCBvciBudW1iZXIgb2YgYnl0ZXMgdG8gZGVsZXRlOiAiIDw8IG9mZnNldAogICAgICAgICAgICAgIDw8ICIsICIgPDwgbnVtQnl0ZXMgPDwgc3RkOjplbmRsOwogICAgcmV0dXJuIGZhbHNlOwogIH0KCiAgLy8g6K+75Y+W5Yig6Zmk5L2N572u5LmL5ZCO55qE5omA5pyJ5pWw5o2uCiAgc3RkOjp2ZWN0b3I8Y2hhcj4gYnVmZmVyKGZpbGVTaXplIC0gKG9mZnNldCArIG51bUJ5dGVzKSk7CiAgZmlsZS5zZWVrZyhvZmZzZXQgKyBudW1CeXRlcyk7CiAgZmlsZS5yZWFkKGJ1ZmZlci5kYXRhKCksIGJ1ZmZlci5zaXplKCkpOwoKICAvLyDnp7vliqjmlofku7bmjIfpkojliLDliKDpmaTkvY3nva4KICBmaWxlLnNlZWtwKG9mZnNldCk7CgogIC8vIOWGmeWbnuWIoOmZpOWQjuWJqeS4i+eahOaVsOaNrgogIGZpbGUud3JpdGUoYnVmZmVyLmRhdGEoKSwgYnVmZmVyLnNpemUoKSk7CgogIC8vIOaIquaWreaWh+S7tgogIGZpbGUuY2xvc2UoKTsKICByZXR1cm4gdHJ1ZTsKfQoKc3RhdGljIGludCB0b19pbnQoc3RkOjpzdHJpbmcgJnMsIGxvbmcgJm4pIHsKICBpZiAoc1swXSA9PSAnMCcgJiYgc1sxXSA9PSAneCcpIHsKICAgIG4gPSBzdGQ6OnN0b2kocy5jX3N0cigpLCBudWxscHRyLCAxNik7CiAgfSBlbHNlIHsKICAgIHRyeSB7CiAgICAgIG4gPSBzdGQ6OnN0b2kocy5jX3N0cigpKTsKICAgIH0gY2F0Y2ggKGNvbnN0IHN0ZDo6aW52YWxpZF9hcmd1bWVudCAmZSkgewogICAgICBzdGQ6OmNlcnIgPDwgIk91dCBvZiByYW5nZTogIiA8PCBlLndoYXQoKSA8PCBzdGQ6OmVuZGw7CiAgICAgIHJldHVybiAtMTsKICAgIH0KICB9CiAgcmV0dXJuIDA7Cn0KCnN0YXRpYyBpbnQgdG9faW50KHN0ZDo6c3RyaW5nICZzLCBpbnQgJm4pIHsKICBpZiAoc1swXSA9PSAnMCcgJiYgc1sxXSA9PSAneCcpIHsKICAgIG4gPSBzdGQ6OnN0b2kocy5jX3N0cigpLCBudWxscHRyLCAxNik7CiAgfSBlbHNlIHsKICAgIHRyeSB7CiAgICAgIG4gPSBzdGQ6OnN0b2kocy5jX3N0cigpKTsKICAgIH0gY2F0Y2ggKGNvbnN0IHN0ZDo6aW52YWxpZF9hcmd1bWVudCAmZSkgewogICAgICBzdGQ6OmNlcnIgPDwgIk91dCBvZiByYW5nZTogIiA8PCBlLndoYXQoKSA8PCBzdGQ6OmVuZGw7CiAgICAgIHJldHVybiAtMTsKICAgIH0KICB9CiAgcmV0dXJuIDA7Cn0KCmludCBtYWluKGludCBhcmdjLCBjaGFyICphcmd2W10pIHsKICBpZiAoYXJnYyA8IDUpIHsKICAgIHN0ZDo6Y2VyciA8PCAiVXNlOiAuL3Rvb2xzIC0tW2luc2VydHxkZWxldGVdIGZpbGUgb2Zmc2V0IHNpemUiIDw8IHN0ZDo6ZW5kbDsKICAgIHJldHVybiAwOwogIH0KCiAgc3RkOjpzdHJpbmcgb3AgPSBhcmd2WzFdOwogIHN0ZDo6c3RyaW5nIGZpbGVfbmFtZSA9IGFyZ3ZbMl07CiAgc3RkOjpzdHJpbmcgczMoYXJndlszXSk7CiAgc3RkOjpzdHJpbmcgczQoYXJndls0XSk7CgogIGxvbmcgb2Zmc2V0ID0gMDsKICBpbnQgbnVtQnl0ZXMgPSAwOwogIHRvX2ludChzMywgb2Zmc2V0KTsKICB0b19pbnQoczQsIG51bUJ5dGVzKTsKCiAgaW50IHJldDsKICBpZiAob3AgPT0gIi0taW5zZXJ0IikKICAgIHJldCA9IGluc2VydEJ5dGVzKGZpbGVfbmFtZSwgb2Zmc2V0LCBudW1CeXRlcyk7CiAgZWxzZSBpZiAob3AgPT0gIi0tZGVsZXRlIikKICAgIHJldCA9IGRlbGV0ZUJ5dGVzKGZpbGVfbmFtZSwgb2Zmc2V0LCBudW1CeXRlcyk7CiAgZWxzZSB7CiAgICBzdGQ6OmNlcnIgPDwgIlVzZTogLi90b29scyAtLVtpbnNlcnR8ZGVsZXRlXSBmaWxlIG9mZnNldCBzaXplIiA8PCBzdGQ6OmVuZGw7CiAgICByZXR1cm4gMDsKICB9CgogIGlmIChyZXQpCiAgICBzdGQ6OmNvdXQgPDwgIlN1Y2Nlc3NmdWxseS4iIDw8IHN0ZDo6ZW5kbDsKICBlbHNlCiAgICBzdGQ6OmNvdXQgPDwgIkVycm9yLiIgPDwgc3RkOjplbmRsOwoKICByZXR1cm4gMDsKfQo=" | base64 -d >op_type.cpp

g++ -std=c++14 ./op_type.cpp -o op_type

rm ./op_type.cpp

echo "ok, output to ./op_type"
